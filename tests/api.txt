iRacing API client
==================

Tests for the iRacing API client.

Data file
---------

This series of tests will work with a cached copy of the memory file, so we need
to get that.

    >>> import os
    >>> mmap_file = os.path.join('tests', 'memorydump.txt')
    >>> mmap_f = open(mmap_file, 'r+b')

And we need to convince the API client that it should actually be using this
file instead of vainly looking in memory for iRacing's. We do this by creating a
file with the correct tag for the API client to inspect.

    >>> import api
    >>> import mmap
    >>> mocked_mmap = mmap.mmap(mmap_f.fileno(), api.MEMMAPFILESIZE,
    ...                         'Local\\IRSDKMemMapFileName')
    >>> api_client = api.API()

YAML (session)
--------------

There is YAML generated for the session, and it updates slowly. The YAML has
been flattened with underscores between keys.
    
    >>> api_client.session('DriverInfo_DriverHeadPosX')
    -0.025000000000000001

You can also see all the keys for the session.

    >>> len(api_client.session_keys)
    62

    >>> api_client.session_keys[0]
    'CameraInfo_Groups'

Telemetry
---------

There is telemetry updated 60 times a second, we can access that in a similar
way - though we do it by key for speed of access.

    >>> api_client.telemetry('Speed')
    1.7011767625808716

Like with the session, you can also see all the keys for the telemetry.

    >>> len(api_client.telemetry_keys)
    95

    >>> api_client.telemetry_keys[0]
    'Brake'

Splat
-----

There's a helper method that we can call to dump everything as a dict.

    >>> _ = api_client.splat